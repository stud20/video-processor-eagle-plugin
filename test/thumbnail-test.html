<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ë„¤ì¼ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            background: #1a1a1a;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-section {
            background: #2d3748;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .thumbnail-test {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .thumbnail-item {
            background: #1a202c;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        .thumbnail-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .debug-info {
            background: #1a202c;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #3182ce;
        }
    </style>
</head>
<body>
    <h1>ğŸ–¼ï¸ Video Processor ì¸ë„¤ì¼ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>í…ŒìŠ¤íŠ¸ ë„êµ¬</h2>
        <button onclick="testBase64Conversion()">Base64 ë³€í™˜ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testFileAccess()">íŒŒì¼ ì ‘ê·¼ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testSmartGroups()">ìŠ¤ë§ˆíŠ¸ ê·¸ë£¹ ë°ì´í„° í™•ì¸</button>
    </div>
    
    <div class="test-section">
        <h2>ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°</h2>
        <div id="thumbnailTest" class="thumbnail-test"></div>
    </div>
    
    <div class="test-section">
        <h2>ë””ë²„ê·¸ ì •ë³´</h2>
        <div id="debugInfo" class="debug-info"></div>
    </div>

    <script>
        // ë””ë²„ê·¸ ë¡œê·¸ ì¶œë ¥
        function log(message, data) {
            const debugDiv = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `[${timestamp}] ${message}\n`;
            if (data) {
                debugDiv.innerHTML += JSON.stringify(data, null, 2) + '\n\n';
            }
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }

        // Base64 ë³€í™˜ í…ŒìŠ¤íŠ¸
        async function testBase64Conversion() {
            log('Base64 ë³€í™˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ ìƒì„± (Canvas API ì‚¬ìš©)
            const canvas = document.createElement('canvas');
            canvas.width = 320;
            canvas.height = 240;
            const ctx = canvas.getContext('2d');
            
            // ê·¸ë¼ë°ì´ì…˜ ë°°ê²½
            const gradient = ctx.createLinearGradient(0, 0, 320, 240);
            gradient.addColorStop(0, '#4299e1');
            gradient.addColorStop(1, '#48bb78');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 320, 240);
            
            // í…ìŠ¤íŠ¸
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('í…ŒìŠ¤íŠ¸ ì¸ë„¤ì¼', 160, 120);
            
            // Base64ë¡œ ë³€í™˜
            const base64 = canvas.toDataURL('image/jpeg', 0.8);
            log('Base64 ìƒì„± ì™„ë£Œ', { length: base64.length });
            
            // ì¸ë„¤ì¼ í‘œì‹œ
            displayThumbnail(base64, 'Canvas í…ŒìŠ¤íŠ¸');
        }

        // íŒŒì¼ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        function testFileAccess() {
            log('íŒŒì¼ ì ‘ê·¼ í…ŒìŠ¤íŠ¸...');
            
            if (window.require) {
                const fs = window.require('fs');
                const path = window.require('path');
                const os = window.require('os');
                
                const testPath = path.join(os.homedir(), '.video-processor-cache', 'analysis');
                log('í…ŒìŠ¤íŠ¸ ê²½ë¡œ', { testPath });
                
                if (fs.existsSync(testPath)) {
                    const files = fs.readdirSync(testPath);
                    log('ì°¾ì€ íŒŒì¼ë“¤', files);
                    
                    // JPG íŒŒì¼ë§Œ í•„í„°ë§
                    const jpgFiles = files.filter(f => f.endsWith('.jpg'));
                    jpgFiles.forEach(file => {
                        const filePath = path.join(testPath, file);
                        const stats = fs.statSync(filePath);
                        log(`íŒŒì¼: ${file}`, { size: stats.size });
                        
                        // Base64ë¡œ ë³€í™˜
                        try {
                            const buffer = fs.readFileSync(filePath);
                            const base64 = `data:image/jpeg;base64,${buffer.toString('base64')}`;
                            displayThumbnail(base64, file);
                        } catch (err) {
                            log(`íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ${file}`, err);
                        }
                    });
                } else {
                    log('ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', { testPath });
                }
            } else {
                log('Node.js ëª¨ë“ˆì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (Eagle ì™¸ë¶€ í™˜ê²½)');
            }
        }

        // ìŠ¤ë§ˆíŠ¸ ê·¸ë£¹ ë°ì´í„° í™•ì¸
        function testSmartGroups() {
            log('ìŠ¤ë§ˆíŠ¸ ê·¸ë£¹ ë°ì´í„° í™•ì¸...');
            
            if (window.VideoProcessor && window.VideoProcessor.smartGroups) {
                const groups = window.VideoProcessor.smartGroups;
                log(`ì´ ${groups.length}ê°œ ê·¸ë£¹ ë°œê²¬`);
                
                groups.forEach((group, index) => {
                    log(`ê·¸ë£¹ #${group.id}`, {
                        members: group.members.length,
                        isGroup: group.isGroup,
                        avgSimilarity: group.avgSimilarity
                    });
                    
                    // ê° ë©¤ë²„ì˜ ì¸ë„¤ì¼ í™•ì¸
                    group.members.forEach((member, memberIndex) => {
                        if (member.thumbnail) {
                            displayThumbnail(member.thumbnail, `ê·¸ë£¹${group.id}-ë©¤ë²„${memberIndex}`);
                            log(`ì¸ë„¤ì¼ ë°œê²¬: ê·¸ë£¹${group.id}-ë©¤ë²„${memberIndex}`, {
                                hasThumb: true,
                                length: member.thumbnail.length
                            });
                        } else {
                            log(`ì¸ë„¤ì¼ ì—†ìŒ: ê·¸ë£¹${group.id}-ë©¤ë²„${memberIndex}`, {
                                framePath: member.framePath
                            });
                        }
                    });
                });
            } else {
                log('ìŠ¤ë§ˆíŠ¸ ê·¸ë£¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ì¸ë„¤ì¼ í‘œì‹œ
        function displayThumbnail(base64, label) {
            const container = document.getElementById('thumbnailTest');
            const item = document.createElement('div');
            item.className = 'thumbnail-item';
            item.innerHTML = `
                <img src="${base64}" class="thumbnail-img" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect width=%22100%22 height=%22100%22 fill=%22%23333%22/%3E%3Ctext x=%2250%22 y=%2250%22 text-anchor=%22middle%22 fill=%22%23999%22%3EâŒ%3C/text%3E%3C/svg%3E'">
                <div>${label}</div>
            `;
            container.appendChild(item);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì •ë³´ í‘œì‹œ
        window.onload = function() {
            log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('Eagle í™˜ê²½ í™•ì¸', {
                hasEagle: typeof eagle !== 'undefined',
                hasRequire: typeof window.require !== 'undefined'
            });
        };
    </script>
</body>
</html>
